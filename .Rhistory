knitr::opts_chunk$set(echo = TRUE)
library (data.table)
library (ggplot2)
library (dplyr)
data.prod <- as.data.table (read.csv ("\\spatiafiles2.bcgov\\Work\\berries\\data\\Productivity_Data.csv")) # productivity data
data.prod <- as.data.table (read.csv ("spatiafiles2.bcgov\\Work\\berries\\data\\Productivity_Data.csv")) # productivity data
data.prod <- as.data.table (read.csv ("G:\\!Workgrp\\Analysts\\wildlife\\grizzly_bear\\berries\\data\\data\\Productivity_Data.csv")) # productivity data
data.prod <- as.data.table (read.csv ("\\ORBITAL\\!Workgrp\\Analysts\\wildlife\\grizzly_bear\\berries\\data\\data\\Productivity_Data.csv")) # productivity data
data.prod <- as.data.table (read.csv ("\\||ORBITAL\\!Workgrp\\Analysts\\wildlife\\grizzly_bear\\berries\\data\\data\\Productivity_Data.csv")) # productivity data
data.prod <- as.data.table (read.csv ("\\\\ORBITAL\\!Workgrp\\Analysts\\wildlife\\grizzly_bear\\berries\\data\\data\\Productivity_Data.csv")) # productivity data
data.prod <- as.data.table (read.csv ("\\\\S63016\\!Workgrp\\Analysts\\wildlife\\grizzly_bear\\berries\\data\\data\\Productivity_Data.csv")) # productivity data
knitr::opts_chunk$set(echo = TRUE)
library (keyring)
library (DBI)
library (RPostgreSQL)
library (sf)
library (raster)
library (exactextractr)
library (data.table)
library (units)
conn <- DBI::dbConnect (PostgreSQL(),
host = keyring::key_get('dbhost', keyring = 'postgreSQL'),
dbname = keyring::key_get('dbname', keyring = 'postgreSQL'),
port='5432',
user=keyring::key_get('dbuser', keyring = 'postgreSQL') ,
password= keyring::key_get('dbpass', keyring = 'postgreSQL'))
## mackenzie timber supply area
sf.mac.tsa.bounds <- st_make_valid (st_read (dsn = "D:/tsr/mackenzie/data/mackenzie_tsa.shp"))
## caribou critical habitat
sf.bc.crit <- st_make_valid (st_read (conn,
query = "SELECT * from bc_critical_habitat_all_herds_20200615;")
)
sf.bc.crit.mac <- sf::st_intersection (sf.mac.tsa.bounds, sf.bc.crit) # in mackenzie only
## watershed areas
sf.awa <- st_make_valid (st_read (dsn = "D:/tsr/mackenzie/data/fwa_assessment_watershed_poly.shp"))
sf.awa.mac <- sf::st_intersection (sf.mac.tsa.bounds, sf.awa) # in mackenzie only
## landscape units
sf.lu <- st_make_valid (st_read (dsn = "D:/tsr/mackenzie/data/landscape_units_2021.shp"))
sf.lu.mac <- sf::st_intersection (sf.mac.tsa.bounds, sf.lu) # in mackenzie only
rm (sf.awa, sf.bc.crit, sf.lu)
gc ()
sf.hab.awa.mac <- sf::st_union (sf.bc.crit.mac, sf.awa.mac)
sf.hab.awa.mac <- sf.hab.awa.mac [sf.hab.lu.mac$bchab_code != "None",]
sf.hab.awa.mac <- sf.hab.awa.mac [sf.hab.awa.mac$bchab_code != "None",]
gc ()
# extract disturbance by decade
## LUs
sf.hab.lu.mac$disturb_ha_2020 <- exactextractr::exact_extract (ras.2020.disturb,
sf.hab.lu.mac,
'sum')
ras.2020.disturb <- raster ("D:/tsr/mackenzie/data/ras_disturb_2020.tif")
ras.2030.disturb <- raster ("D:/tsr/mackenzie/data/ras_disturb_2030.tif")
ras.2040.disturb <- raster ("D:/tsr/mackenzie/data/ras_disturb_2040.tif")
ras.2050.disturb <- raster ("D:/tsr/mackenzie/data/ras_disturb_2050.tif")
ras.2060.disturb <- raster ("D:/tsr/mackenzie/data/ras_disturb_2060.tif")
ras.2070.disturb <- raster ("D:/tsr/mackenzie/data/ras_disturb_2070.tif")
ras.2080.disturb <- raster ("D:/tsr/mackenzie/data/ras_disturb_2080.tif")
ras.2090.disturb <- raster ("D:/tsr/mackenzie/data/ras_disturb_2090.tif")
# extract disturbance by decade
## LUs
sf.hab.lu.mac$disturb_ha_2020 <- exactextractr::exact_extract (ras.2020.disturb,
sf.hab.lu.mac,
'sum')
## AWAs
sf.hab.awa.mac$disturb_ha_2020 <- exactextractr::exact_extract (ras.2020.disturb,
sf.hab.awa.mac,
'sum')
## AWAs
sf.hab.awa.mac$disturb_ha_2020 <- exactextractr::exact_extract (ras.2020.disturb,
sf.hab.awa.mac,
'sum')
sf.hab.awa.mac$disturb_ha_2030 <- exactextractr::exact_extract (ras.2030.disturb,
sf.hab.awa.mac,
'sum')
sf.hab.awa.mac$disturb_ha_2040 <- exactextractr::exact_extract (ras.2040.disturb,
sf.hab.awa.mac,
'sum')
sf.hab.awa.mac$disturb_ha_2050 <- exactextractr::exact_extract (ras.2050.disturb,
sf.hab.awa.mac,
'sum')
sf.hab.awa.mac$disturb_ha_2060 <- exactextractr::exact_extract (ras.2060.disturb,
sf.hab.awa.mac,
'sum')
sf.hab.awa.mac$disturb_ha_2070 <- exactextractr::exact_extract (ras.2070.disturb,
sf.hab.awa.mac,
'sum')
sf.hab.awa.mac$disturb_ha_2080 <- exactextractr::exact_extract (ras.2080.disturb,
sf.hab.awa.mac,
'sum')
sf.hab.awa.mac$disturb_ha_2090 <- exactextractr::exact_extract (ras.2090.disturb,
sf.hab.awa.mac,
'sum')
# calculate area of polys
sf.hab.awa.mac$calc_area_m2 <- st_area (sf.hab.awa.mac)
# drop geometry, calculate area in ha's and subset data
disturb.hab.awa.mac <- as.data.table (sf::st_drop_geometry (sf.hab.awa.mac))
View(disturb.hab.awa.mac)
View(sf.hab.awa.mac)
View(disturb.hab.awa.mac)
disturb.hab.awa.mac$calc_area_ha <- disturb.hab.awa.mac$calc_area_m2 * 0.0001
rm (sf.bc.crit.mac, sf.awa.mac)
gc ()
View(disturb.hab.awa.mac)
disturb.hab.awa.mac <- disturb.hab.awa.mac [, c ('TSA_NUMB_1', 'herd_name', 'bc_habitat_type', 'bchab_code', 'GNIS_ID_1', 'GNIS_NAME_', 'WATERSHE_5', 'calc_area_ha', 'disturb_ha_2020', 'disturb_ha_2030', 'disturb_ha_2040', 'disturb_ha_2050', 'disturb_ha_2060', 'disturb_ha_2070', 'disturb_ha_2080', 'disturb_ha_2090')]
disturb.hab.awa.mac$calc_area_ha <- units::drop_units (disturb.hab.awa.mac$calc_area_ha)
# summarize by watershed
summ.disturb.awa <- disturb.hab.awa.mac [, .(disturb_ha_2020 = sum (disturb_ha_2020),
disturb_ha_2030 = sum (disturb_ha_2030),
disturb_ha_2040 = sum (disturb_ha_2040),
disturb_ha_2050 = sum (disturb_ha_2050),
disturb_ha_2060 = sum (disturb_ha_2060),
disturb_ha_2070 = sum (disturb_ha_2070),
disturb_ha_2080 = sum (disturb_ha_2080),
disturb_ha_2090 = sum (disturb_ha_2090),
calc_area_ha = sum (calc_area_ha) ), by = .(GNIS_NAME_)]
View(summ.disturb.awa)
summ.disturb.crit.hab [, perc_disturb_2020 := (disturb_ha_2020 / calc_area_ha)*100]
summ.disturb.awa [, perc_disturb_2020 := (disturb_ha_2020 / calc_area_ha)*100]
summ.disturb.awa [, perc_disturb_2030 := (disturb_ha_2030 / calc_area_ha)*100]
summ.disturb.awa [, perc_disturb_2040 := (disturb_ha_2040 / calc_area_ha)*100]
summ.disturb.awa [, perc_disturb_2050 := (disturb_ha_2050 / calc_area_ha)*100]
summ.disturb.awa [, perc_disturb_2060 := (disturb_ha_2060 / calc_area_ha)*100]
summ.disturb.awa [, perc_disturb_2070 := (disturb_ha_2070 / calc_area_ha)*100]
summ.disturb.awa [, perc_disturb_2080 := (disturb_ha_2080 / calc_area_ha)*100]
summ.disturb.awa [, perc_disturb_2090 := (disturb_ha_2090 / calc_area_ha)*100]
write.table (summ.disturb.crit.hab,
file = "D:\\tsr\\mackenzie\\data\\disturbance_by_awa.csv",
sep = ",")
write.table (summ.disturb.awa,
file = "D:\\tsr\\mackenzie\\data\\disturbance_by_awa.csv",
sep = ",")
View(disturb.hab.awa.mac)
View(summ.disturb.awa)
disturb_ha_2020 <- exactextractr::exact_extract (ras.2020.disturb,
sf.hab.awa.mac,
'sum')
View(disturb.hab.awa.mac)
View(disturb.hab.awa.mac)
gc ()
