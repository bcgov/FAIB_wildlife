---
title: "Moose Analysis for the Kispiox Timber Supply Review"
author: "Tyler Muhly, Forest Analysis and Inventory Branch"
date: "25/11/2021"
output: html_document
---

```{r setup and data, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library (here)
library (ggplot2)
library (data.table)
library (sf)
library (dplyr)
library (viridis)
library (ggrepel)
library (ggspatial)
library (units)

tsa_bound <- st_make_valid (sf::st_read(here ("data/kispiox/kispiox_2021.gdb"), layer = "tsa_bound"))
gbpu <- st_make_valid (sf::st_read(here ("data/kispiox/kispiox_2021.gdb"), layer = "gbpu"))
roads <- st_make_valid (sf::st_read (here ("data/kispiox/kispiox_2021.gdb"), layer = "roads_dra_ften"))
lu <- st_make_valid (sf::st_read (here ("data/kispiox/kispiox_2021.gdb"), layer = "lu"))
wha <- st_make_valid (sf::st_read (here ("data/kispiox/kispiox_2021.gdb"), layer = "wha_6055"))
bec <- st_make_valid (sf::st_read (here ("data/kispiox/kispiox_2021.gdb"), layer = "bec"))
mid.seral <- st_make_valid (sf::st_read (here ("data/kispiox/kispiox_2021.gdb"), layer = "mid_seral"))
```

## Background
Moose (*Alces alces*) are a highly valued wildlife species in North America for a variety of cultural and economic reasons ( [Timmermann and Rogers 2005](https://pdfs.semanticscholar.org/55d2/86e83dd7cae6da270c153858b3d1a98d89de.pdf)). Prior to European colonization, moose were used extensively by Indigenous peoples for food, clothing and shelter ( [Moose In British Columbia](http://www.env.gov.bc.ca/wld/documents/moose.pdf)). In the last 100 years, moose have become an important, nutritious, staple food of many interior and coastal First Nations communities in BC ( [First Nations Health Authority fact sheet](https://www.fnha.ca/Documents/Traditional_Food_Fact_Sheets.pdf)). 


### Federal Status






### Provincial Status



### First Nations Status



### Conservation Status of Grizzly Bear in the Kispiox TSA



```{r gbpu status, warning = F, message = F, echo = F}

ggplot (data = gbpu) +
        geom_sf (aes (fill = CONSERVATION_CONCERN_RANK)) +
        geom_sf (data = tsa_bound, fill = NA, linetype = "longdash", size = 1.1, colour = "green") +
        geom_sf_label (data = gbpu, aes(label = POPULATION_NAME)) +
        xlab("Longitude") + ylab("Latitude") +
        ggtitle ("Conservation Status of Grizzly Bear Population Units 
Overlapping the Kispiox Timber Supply Area") +
        scale_fill_viridis (option="turbo", discrete = T) +
        guides (fill = guide_legend (title = "Provincial Conservation Status")) +
        annotation_scale(location = "br", width_hint = 0.5, pad_y = unit(-0.001, "in")) +
        annotation_north_arrow(location = "br", which_north = "true", 
              pad_x = unit(0, "in"), pad_y = unit(0.1, "in"),
              style = north_arrow_fancy_orienteering) +
        labs (caption = "Kispiox TSA boundary indicated by green dashed line.") +
        theme (axis.text.x = element_text (angle = 30, hjust = 1))

```

## Relationship to Forestry





Research has shown that forestry activity influences moose density and distribution, both positively and negatively. Forestry cutblocks remove forest canopy, which generally increases the production of deciduous shrub browse on landscapes, which can positively influence moose. Shrub production in forestry cutblocks varies, but appears to peak anywhere from at 5 to 30 years after harvest, and moose appear to use these stand ages the most. Cutblocks less than 5 years old and older than 30 years old (i.e., mid-seral stands), appear to generally be of less forage value to moose and receive less use as foraging habitat. However, older stands, including mature cutblocks, can benefit moose by providing valuable cover habitat. Closed canopy conifer forest stands are important habitat for providing thermal cover in summer and to intercept snow in high snowfall years or areas. 

Forest harvest, when done in moderation and in a way that creates a diversity of forest stand ages and types, can benefit moose. However, the creation of road infrastrucutre to extract timber may negatively affect moose density and distribution overall. Forestry roads can make areas more accessible to moose hunters, increasing hunting mortality, which can limit moose population size. The overall effects of forestry on moose may be negative when roads endure on the landscape and are not actively decommissioned or recovered. 

Moose have an important and complex relationship with forestry development. Based on a review of previous research on the effects of forestry on moose, the relationship is most likely to be positive when:
  - At the scale of a moose home range (i.e., approximately 10 km^2^), forest cutblocks are interspersed with large mature or old forest stands, and cut in a progressive way over a 5 to 10 year period so there is a distribution of cutblock ages 
  - Silvicultural practices on harvested stands allow for growth of some shrubs, particularly along cutblock edges with mature stands   
  - Roads are minimized, blocked, deactivated or restored
  
  
  


 
  

### Roads
- road density in a watershed area, with an ideal target of less than 1km/km^2^   


### Forest Stand Characteristics
  - percentage of watershed area that is 5 to 30 years old, with an ideal percentage of 30%
 - percentage of watershed area that is conifer stands greater than 5 ha in size and 15m tall, with an ideal percentage of 40%

## Current Conditions



### Population Status and Trend
Moose population data was obtained by searching the BC government's [species inventory web explorer (SIWE)](https://catalogue.data.gov.bc.ca/dataset/species-inventory-web-explorer-siwe) for 'moose' inventory data collected in the Skeena region. Any data on moose density, populations, bull:cow ratios and calf:cow ratios was compiled. 

```{r, moose pop density map, fig.cap = "Figure 1. Most recent moose density estimates by wildlife management unit in the Okanagan Timber Supply Area.", eval = T, echo = F, message = F, warning = F}
data.moose.pop <- read.csv (file = here ("wildlife/data/okanagan/moose_density_20200504.csv"),
                            header = T)
data.wmu <- sf::st_read (dsn = "C:\\Work\\tsr\\data\\okanagan_tsr_20200407.gdb",
                         layer = "clip_wmu", 
                         quiet = T)
data.tsa <- sf::st_read (dsn = "C:\\Work\\tsr\\data\\okanagan_tsr_20200407.gdb",
                         layer = "tsa_outer", 
                         quiet = T)

data.wmu.moose <- merge (data.wmu, data.moose.pop, all = TRUE)
data.wmu.moose.dns <- data.wmu.moose %>%
                        filter (!is.na (density)) 
data.wmu.moose.dns <- data.wmu.moose.dns [data.wmu.moose.dns$WILDLIFE_MGMT_UNIT_ID != "4-32" &
                                          data.wmu.moose.dns$WILDLIFE_MGMT_UNIT_ID != "4-39" &
                                          data.wmu.moose.dns$WILDLIFE_MGMT_UNIT_ID != "3-42" &
                                          data.wmu.moose.dns$WILDLIFE_MGMT_UNIT_ID != "8-4" &
                                          data.wmu.moose.dns$WILDLIFE_MGMT_UNIT_ID != "8-15" , ]
data.wmu.moose.dns <- data.wmu.moose.dns [-c (5, 10, 12, 13, 17), ] # 10, 16, 18, 19, 24 
data.wmu.moose.dns$brks_density <- cut (data.wmu.moose.dns$density, 
                                        breaks = c (0, 0.10, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 
                                                    0.80, 0.90, 1.00, Inf), 
                                        labels = c ("0 - 0.09", "0.10 - 0.19", "0.20 - 0.29", "0.30 - 0.39",
                                                    "0.40 - 0.49", "0.50 - 0.59", "0.60 - 0.69", "0.70 - 0.79",
                                                    "0.80 - 0.89", "0.90 - 1.00", ">1.00"))

data.wmu.moose.dns <- cbind (data.wmu.moose.dns, st_coordinates (st_centroid (data.wmu.moose.dns)))

ggplot (data = data.wmu.moose.dns) +
        geom_sf (data = data.wmu.moose.dns, aes (fill = brks_density)) +
        geom_sf (data = data.tsa, fill = NA) +
        scale_fill_discrete () +
        scale_fill_brewer (type = "div",
                           palette = "RdBu",
                           direction = -1,
                           aesthetics = "fill",
                           na.value = "orange") +
        annotation_scale (location = "br", 
                          width_hint = 0.5, 
                          height = unit (0.1, "cm")) +
        annotation_north_arrow (location = "tl", 
                                which_north = "true", 
                                style = north_arrow_fancy_orienteering,
                                height = unit (1.25, "cm"),
                                width = unit (1, "cm")) +
        labs (fill = "Density (moose/km2)") +
        geom_label(data = data.wmu.moose.dns, 
                   aes(X, Y, label = density), 
                   size = 2.5) +
        theme (axis.title.x = element_blank(),
               axis.title.y = element_blank())
```



```{r gbpu bear density, warning = F, message = F, echo = F}

t.gbpu <- as.data.table (gbpu$POPULATION_NAME)
setnames (t.gbpu, "POPULATION_NAME")
t.gbpu [t.gbpu$POPULATION_NAME == "Babine", density := 23]
t.gbpu [t.gbpu$POPULATION_NAME == "Bulkley-Lakes", density := 20]
t.gbpu [t.gbpu$POPULATION_NAME == "Cranberry", density := 30]
gbpu <- merge (gbpu, t.gbpu, by = "POPULATION_NAME")

ggplot (data = gbpu) +
        geom_sf (aes (fill = density)) +
        geom_sf (data = tsa_bound, fill = NA, linetype = "longdash", size = 1.1, colour = "green") +
        #geom_sf_label (data = gbpu, aes(label = density)) +
        xlab("Longitude") + ylab("Latitude") +
        ggtitle ("Density of Grizzly Bears in Grizzly Bear Population Units
Overlapping the Kispiox Timber Supply Area") +
        scale_fill_viridis (option="plasma") +
        guides (fill = guide_legend (title = "Density (Bears/1,000km2)")) +
        annotation_scale(location = "br", width_hint = 0.5, pad_y = unit(-0.001, "in")) +
        annotation_north_arrow(location = "br", which_north = "true", 
              pad_x = unit(0, "in"), pad_y = unit(0.1, "in"),
              style = north_arrow_fancy_orienteering) +
        labs (caption = "Kispiox TSA boundary indicated by green dashed line.") +
        theme (axis.text.x = element_text (angle = 30, hjust = 1))

```



### Roads



```{r gbpu lu road density, warning = F, message = F, echo = F}
lu.road.length <- st_drop_geometry (st_intersection (roads, lu) %>% 
                                      dplyr::mutate (length_m = sf::st_length(Shape)) %>% 
                                        dplyr::group_by (LANDSCAPE_UNIT_NAME) %>% 
                                          dplyr::summarize (length_m = sum(length_m)))
lu.road.length$road_length_km <- lu.road.length$length_m / 1000
lu.road.length$road_length_km  <- units::drop_units (lu.road.length$road_length_km )
setDT (lu.road.length) [, length_m := NULL]
lu <- merge (lu, lu.road.length, by = "LANDSCAPE_UNIT_NAME")
lu$area_km2 <- lu$GEOMETRY_Area / 1000000
lu$road_dens <- lu$road_length_km / lu$area_km2

ggplot (data = lu) +
        geom_sf (aes (fill = road_dens)) +
        geom_sf (data = tsa_bound, fill = NA, linetype = "longdash", size = 1.1, colour = "green") +
        geom_sf (data = gbpu, fill = NA, linetype = "longdash", size = 0.9, colour = "blue") +
        #geom_sf_label (data = gbpu, aes(label = POPULATION_NAME)) +
        xlab("Longitude") + ylab("Latitude") +
        ggtitle ("Density of Roads in Landscape Units 
Overlapping the Kispiox Timber Supply Area") +
        scale_fill_viridis (option = "magma", breaks = c (0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6)) +
        guides (fill = guide_legend (title = "Road Density (km/km2)")) +
        annotation_scale(location = "br", width_hint = 0.5, pad_y = unit(-0.001, "in")) +
        annotation_north_arrow(location = "br", which_north = "true", 
              pad_x = unit(0, "in"), pad_y = unit(0.1, "in"),
              style = north_arrow_fancy_orienteering) +
        labs (caption = "Kispiox TSA boundary indicated by green dashed line. 
              GBPUs indicated by blue dashed line.") +
        theme (axis.text.x = element_text (angle = 30, hjust = 1))
```

### Forest Stand Characteristics



```{r gbpu lu mid-seral, warning = F, message = F, echo = F}

# data was obtained from VRI - BCLCS_LEVEL_1 = 'V' AND BCLCS_LEVEL_2 = 'T' AND BCLCS_LEVEL_4 = 'TC' AND BEC_ZONE_CODE = 'CWH' OR BEC_ZONE_CODE = 'ICH' OR BEC_ZONE_CODE = 'SBS' AND PROJ_AGE_1 > 40 AND PROJ_AGE_1 < 100

area.mid.seral.lu <- st_drop_geometry (st_intersection (mid.seral, lu) %>% 
                                         dplyr::mutate (area_m2 = sf::st_area(GEOMETRY)) %>% 
                                           dplyr::group_by (LANDSCAPE_UNIT_NAME) %>% 
                                            dplyr::summarize (mid_seral_area_ha = sum (units::drop_units (area_m2) * 0.0001)))
area.bec.lu <- st_drop_geometry (st_intersection (bec, lu) %>% 
                                    dplyr::filter (ZONE == 'CWH' | ZONE == 'ICH' | ZONE == 'SBS') %>%     
                                        dplyr::mutate (area_m2 = sf::st_area(GEOMETRY)) %>%    
                                         dplyr::group_by (LANDSCAPE_UNIT_NAME) %>% 
                                          dplyr::summarize (bec_area_ha = sum (units::drop_units (area_m2) * 0.0001)))
#area.bec.lu$bec_area_ha <- area.bec.lu$bec_area_m2 * 0.0001 
area.mid.seral.lu <- merge (area.mid.seral.lu, area.bec.lu, by = c ("LANDSCAPE_UNIT_NAME"))

area.mid.seral.lu$perc_mid_seral <- (area.mid.seral.lu$mid_seral_area_ha / area.mid.seral.lu$bec_area_ha) * 100

lu <-  merge (lu, area.mid.seral.lu,  by = "LANDSCAPE_UNIT_NAME")

ggplot (data = lu) +
        geom_sf (aes (fill = perc_mid_seral)) +
        geom_sf (data = tsa_bound, fill = NA, linetype = "longdash", size = 1.1, colour = "green") +
        geom_sf (data = gbpu, fill = NA, linetype = "longdash", size = 0.9, colour = "blue") +
        #geom_sf_label (data = gbpu, aes(label = POPULATION_NAME)) +
        xlab("Longitude") + ylab("Latitude") +
        ggtitle ("Percent Mid-Seral CWH, ICH and SBS 
Conifer Forest in Landscape Units Overlapping 
the Kispiox Timber Supply Area") +
        scale_fill_viridis (option = "magma", breaks = c (0, 1, 2, 4, 5, 6, 7, 8)) +
        guides (fill = guide_legend (title = "Percent (%) Mid-Seral")) +
        annotation_scale(location = "br", width_hint = 0.5, pad_y = unit(-0.001, "in")) +
        annotation_north_arrow(location = "br", which_north = "true", 
              pad_x = unit(0, "in"), pad_y = unit(0.1, "in"),
              style = north_arrow_fancy_orienteering) +
        labs (caption = "Kispiox TSA boundary indicated by green dashed line. 
              GBPUs indicated by blue dashed line.") +
        theme (axis.text.x = element_text (angle = 30, hjust = 1))
```

## Future Conditions
- analyze outputs from timber supply models, if/when available

### Alternate Forest Management Regimes for Grizzly Bear
- is there a moose focused scenario we could analyze?

### Roads

### Forest Stand Characteristics

### Timber Supply

## Mitigating Potential Impacts of Forest Harvest to Grizzly Bear


## Uncertainties and Limitations 

